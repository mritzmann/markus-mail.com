# https://securityheaders.com
securityheaders:
  stage: test
  image: debian:latest
  variables:
    GIT_STRATEGY: none
    URL: https://markusritzmann.ch/
  script:
  - apt update
  - apt -y install curl grep cowsay
  # prevent duplicate entry
  - echo "prevent duplicate entry" | /usr/games/cowsay
  - if [ "$(curl --head --silent $URL | cut -d ":" -f1 | uniq --count --ignore-case --repeated | wc --line)" -eq 0 ] ; then echo ok ; else exit 1; fi
  # Content-Security-Policy
  - echo "Content-Security-Policy" | /usr/games/cowsay
  - curl --head --silent $URL | grep --ignore-case Content-Security-Policy
  # X-Frame-Options
  - echo "X-Frame-Options" | /usr/games/cowsay
  - curl --head --silent $URL | grep --ignore-case X-Frame-Options
  # X-Xss-Protection
  - echo "X-Xss-Protection" | /usr/games/cowsay
  - curl --head --silent $URL | grep --ignore-case X-Xss-Protection
  # Referrer-Policy
  - echo "Referrer-Policy" | /usr/games/cowsay
  - curl --head --silent $URL | grep --ignore-case Referrer-Policy
  # X-Content-Type-Options
  - echo "X-Content-Type-Options" | /usr/games/cowsay
  - curl --head --silent $URL | grep --ignore-case X-Content-Type-Options
